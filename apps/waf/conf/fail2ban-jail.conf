# fail2ban jail for Django WAF
# Place in /etc/fail2ban/jail.d/django-waf.conf
#
# This jail monitors Django WAF security logs and bans IPs
# that trigger too many security events.

[django-waf]
enabled = true

# Ports to ban (HTTP and HTTPS)
port = http,https

# Use the django-waf filter
filter = django-waf

# Path to Django security log
# Update this to match your WAF_LOG_PATH setting
logpath = /var/log/django/security.log

# Ban settings
# maxretry: Number of failures before ban
# findtime: Time window in seconds to count failures
# bantime: How long to ban in seconds

# Standard settings (production)
maxretry = 5
findtime = 300
bantime = 3600

# Aggressive settings (uncomment for stricter protection)
# maxretry = 3
# findtime = 600
# bantime = 86400

# Ban action
# Default: iptables-multiport
# Options: iptables, iptables-allports, nftables, etc.
banaction = iptables-multiport

# For cloud environments with load balancers, you may need:
# banaction = iptables-multiport[blocktype=DROP]

# Email notifications (optional)
# Uncomment and configure if you want email alerts
# action = %(action_mwl)s
# destemail = admin@example.com
# sender = fail2ban@example.com
# mta = sendmail

# Whitelist (IPs that should never be banned)
# ignoreip = 127.0.0.1/8 ::1
# Add your office/home IP here:
# ignoreip = 127.0.0.1/8 ::1 192.168.1.0/24

# Backend for log monitoring
# auto: fail2ban will try to automatically determine
# pyinotify: uses inotify (recommended for Linux)
# systemd: uses systemd journal
backend = auto

# -----------------------------------------------------------
# Additional jail for more aggressive protection (optional)
# -----------------------------------------------------------

# [django-waf-aggressive]
# enabled = false
# port = http,https
# filter = django-waf
# logpath = /var/log/django/security.log
#
# # Very strict: 3 events in 10 minutes = 24 hour ban
# maxretry = 3
# findtime = 600
# bantime = 86400
#
# # Recidive multiplier: repeat offenders get longer bans
# # Requires fail2ban 0.9.0+
# bantime.increment = true
# bantime.factor = 2
# bantime.maxtime = 604800

# -----------------------------------------------------------
# Testing the configuration
# -----------------------------------------------------------
#
# 1. Test filter regex:
#    fail2ban-regex /var/log/django/security.log /etc/fail2ban/filter.d/django-waf.conf
#
# 2. Check jail status:
#    fail2ban-client status django-waf
#
# 3. Manually ban/unban for testing:
#    fail2ban-client set django-waf banip 192.168.1.100
#    fail2ban-client set django-waf unbanip 192.168.1.100
#
# 4. View banned IPs:
#    fail2ban-client status django-waf
#
# 5. Check fail2ban logs:
#    tail -f /var/log/fail2ban.log
