{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Pedido" %} {{ order.order_number }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <nav class="mb-4">
            <a href="{% url 'store:order_list' %}" class="text-primary-600 hover:text-primary-500 flex items-center text-sm">
                <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                {% trans "Volver a mis pedidos" %}
            </a>
        </nav>

        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">{% trans "Pedido" %} {{ order.order_number }}</h1>
                <p class="mt-1 text-sm text-gray-500">
                    {% trans "Realizado el" %} {{ order.created_at|date:"d F Y" }} {% trans "a las" %} {{ order.created_at|time:"H:i" }}
                </p>
            </div>
            <div class="mt-4 sm:mt-0">
                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium
                    {% if order.status == 'pending' %}bg-yellow-100 text-yellow-800
                    {% elif order.status == 'paid' %}bg-blue-100 text-blue-800
                    {% elif order.status == 'preparing' %}bg-indigo-100 text-indigo-800
                    {% elif order.status == 'ready' %}bg-green-100 text-green-800
                    {% elif order.status == 'shipped' %}bg-purple-100 text-purple-800
                    {% elif order.status == 'delivered' %}bg-green-100 text-green-800
                    {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
                    {% elif order.status == 'refunded' %}bg-gray-100 text-gray-800
                    {% endif %}">
                    {{ order.get_status_display }}
                </span>
            </div>
        </div>
    </div>

    <div class="lg:grid lg:grid-cols-12 lg:gap-8">
        <!-- Order Details -->
        <div class="lg:col-span-8">
            <!-- Order Items -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">{% trans "Artículos del pedido" %}</h2>
                </div>
                <ul class="divide-y divide-gray-200">
                    {% for item in order.items.all %}
                    <li class="p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 w-20 h-20">
                                {% if item.product.primary_image %}
                                <img src="{{ item.product.primary_image.image.url }}" alt="{{ item.product_name }}"
                                     class="w-full h-full object-cover rounded-md">
                                {% else %}
                                <div class="w-full h-full bg-gray-200 rounded-md flex items-center justify-center">
                                    <svg class="h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                {% endif %}
                            </div>
                            <div class="ml-6 flex-1">
                                <div class="flex justify-between">
                                    <div>
                                        <h3 class="text-base font-medium text-gray-900">{{ item.product_name }}</h3>
                                        {% if item.product_sku %}
                                        <p class="mt-1 text-sm text-gray-500">SKU: {{ item.product_sku }}</p>
                                        {% endif %}
                                    </div>
                                    <p class="text-base font-medium text-gray-900">${{ item.subtotal }}</p>
                                </div>
                                <p class="mt-2 text-sm text-gray-500">
                                    {% trans "Cantidad" %}: {{ item.quantity }} × ${{ item.price }}
                                </p>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Fulfillment Information -->
            <div class="mt-6 bg-white rounded-lg shadow overflow-hidden">
                <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">{% trans "Información de entrega" %}</h2>
                </div>
                <div class="p-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            {% if order.fulfillment_method == 'pickup' %}
                            <svg class="h-6 w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                            {% else %}
                            <svg class="h-6 w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            {% endif %}
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-900">{{ order.get_fulfillment_method_display }}</h3>
                            {% if order.fulfillment_method == 'pickup' %}
                            <p class="mt-2 text-sm text-gray-500">
                                {% trans "Recoge tu pedido en:" %}<br>
                                <strong>Pet-Friendly Veterinaria</strong><br>
                                Puerto Morelos, Quintana Roo<br>
                                {% trans "Horario: Mar-Dom 9:00-20:00" %}
                            </p>
                            {% else %}
                            <div class="mt-2 text-sm text-gray-500">
                                <p><strong>{{ order.shipping_name }}</strong></p>
                                <p>{{ order.shipping_address|linebreaks }}</p>
                                {% if order.shipping_phone %}
                                <p>{% trans "Tel" %}: {{ order.shipping_phone }}</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Information -->
            <div class="mt-6 bg-white rounded-lg shadow overflow-hidden">
                <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">{% trans "Información de pago" %}</h2>
                </div>
                <div class="p-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            {% if order.payment_method == 'cash' %}
                            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            {% elif order.payment_method == 'card' %}
                            <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                            </svg>
                            {% else %}
                            <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z" />
                            </svg>
                            {% endif %}
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-900">{{ order.get_payment_method_display }}</h3>
                            {% if order.payment_method == 'cash' and order.status == 'pending' %}
                            <p class="mt-2 text-sm text-gray-500">
                                {% trans "Pagar al recoger o recibir tu pedido." %}
                            </p>
                            {% elif order.payment_method == 'transfer' and order.status == 'pending' %}
                            <p class="mt-2 text-sm text-gray-500">
                                {% trans "Realiza tu transferencia a:" %}<br>
                                <strong>Banco: BBVA</strong><br>
                                {% trans "CLABE" %}: 0123 4567 8901 2345 67<br>
                                {% trans "Referencia" %}: {{ order.order_number }}
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="lg:col-span-4 mt-8 lg:mt-0">
            <div class="bg-white rounded-lg shadow p-6 sticky top-4">
                <h2 class="text-lg font-medium text-gray-900 mb-4">{% trans "Resumen del pedido" %}</h2>

                <dl class="space-y-4">
                    <div class="flex items-center justify-between">
                        <dt class="text-sm text-gray-600">{% trans "Subtotal" %}</dt>
                        <dd class="text-sm font-medium text-gray-900">${{ order.subtotal }}</dd>
                    </div>
                    {% if order.discount_amount > 0 %}
                    <div class="flex items-center justify-between">
                        <dt class="text-sm text-gray-600">{% trans "Descuento" %}</dt>
                        <dd class="text-sm font-medium text-green-600">-${{ order.discount_amount }}</dd>
                    </div>
                    {% endif %}
                    <div class="flex items-center justify-between">
                        <dt class="text-sm text-gray-600">{% trans "IVA" %}</dt>
                        <dd class="text-sm font-medium text-gray-900">${{ order.tax }}</dd>
                    </div>
                    {% if order.shipping_cost > 0 %}
                    <div class="flex items-center justify-between">
                        <dt class="text-sm text-gray-600">{% trans "Envío" %}</dt>
                        <dd class="text-sm font-medium text-gray-900">${{ order.shipping_cost }}</dd>
                    </div>
                    {% endif %}
                    <div class="flex items-center justify-between border-t border-gray-200 pt-4">
                        <dt class="text-base font-medium text-gray-900">{% trans "Total" %}</dt>
                        <dd class="text-base font-medium text-gray-900">${{ order.total }}</dd>
                    </div>
                </dl>

                {% if order.status == 'pending' %}
                <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
                    <div class="flex">
                        <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-yellow-800">{% trans "Pago pendiente" %}</h3>
                            <p class="mt-1 text-sm text-yellow-700">
                                {% trans "Este pedido está esperando confirmación de pago." %}
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if order.paid_at %}
                <div class="mt-6 p-4 bg-green-50 rounded-lg">
                    <div class="flex">
                        <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">{% trans "Pago confirmado" %}</h3>
                            <p class="mt-1 text-sm text-green-700">
                                {{ order.paid_at|date:"d M Y, H:i" }}
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Contact Support -->
            <div class="mt-6 bg-white rounded-lg shadow p-6">
                <h3 class="text-sm font-medium text-gray-900">{% trans "¿Necesitas ayuda?" %}</h3>
                <p class="mt-2 text-sm text-gray-500">
                    {% trans "Contáctanos si tienes preguntas sobre tu pedido." %}
                </p>
                <a href="{% url 'core:contact' %}" class="mt-4 inline-flex items-center text-sm text-primary-600 hover:text-primary-500">
                    {% trans "Contactar soporte" %}
                    <svg class="ml-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
